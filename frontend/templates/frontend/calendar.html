<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IKIGAI Integrated Workspace</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <style>
    /* Googleãƒ©ã‚¤ã‚¯ãªåŸºæœ¬è¨­å®š */
    body, html { height: 100%; margin: 0; overflow: hidden; font-family: 'Roboto', sans-serif; background: #fff; }
    
    .dashboard-container { display: flex; height: 100vh; width: 100%; }

    /* å·¦ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
    .sidebar-left {
      width: 260px; background: #fff; border-right: 1px solid #dadce0;
      display: flex; flex-direction: column; padding: 12px;
      transition: width 0.2s; flex-shrink: 0;
    }
    .app-title { font-size: 22px; color: #5f6368; display: flex; align-items: center; margin-bottom: 20px; padding-left: 10px;}
    .app-title .material-icons { margin-right: 8px; color: #1967d2; }

    /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒªã‚¹ãƒˆ */
    .section-label { font-size: 11px; font-weight: 500; color: #5f6368; margin: 15px 0 5px 10px; text-transform: uppercase; letter-spacing: 0.5px; }
    .user-item {
      padding: 8px 10px 8px 16px; border-radius: 0 20px 20px 0; cursor: pointer;
      display: flex; align-items: center; font-size: 14px; color: #3c4043; margin-bottom: 2px;
    }
    .user-item:hover { background-color: #f1f3f4; }
    .user-item.active { background-color: #e8f0fe; color: #1967d2; font-weight: 500; }
    .user-avatar { width: 32px; height: 32px; border-radius: 50%; margin-right: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 14px;}

    /* ä¸­å¤®ãƒ¡ã‚¤ãƒ³ */
    .main-content { flex-grow: 1; position: relative; display: flex; flex-direction: column; min-width: 0; }
    #calendar { flex-grow: 1; padding: 20px; }

    /* å³ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼ˆé–‹é–‰å¼ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼‰ */
    .sidebar-right {
      width: 300px; background: #fff; border-left: 1px solid #dadce0;
      box-shadow: -4px 0 8px rgba(0,0,0,0.05);
      position: absolute; right: 0; top: 0; bottom: 0; z-index: 1000;
      background-color: white;
      transform: translateX(100%); /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯éš ã™ */
      transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
      display: flex; flex-direction: column;
    }
    .sidebar-right.open { transform: translateX(0); } /* ã‚¯ãƒ©ã‚¹ä»˜ä¸ã§è¡¨ç¤º */

    /* å³ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒ˜ãƒƒãƒ€ãƒ¼ */
    .prop-header { padding: 16px; border-bottom: 1px solid #dadce0; display: flex; justify-content: space-between; align-items: center; }
    .close-prop-btn { cursor: pointer; color: #5f6368; border: none; background: none; }

    /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆãƒãƒƒãƒ—ã‚ªãƒ¼ãƒãƒ¼é¢¨ï¼‰ */
    .action-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
    .action-card {
      border: 1px solid #dadce0; border-radius: 8px; padding: 15px; text-align: center; cursor: pointer;
      transition: 0.2s; background: white;
    }
    .action-card:hover { background: #f8f9fa; box-shadow: 0 1px 3px rgba(0,0,0,0.12); border-color: transparent; }
    .action-card .material-icons { font-size: 32px; margin-bottom: 8px; color: #1967d2; }
    .action-label { font-size: 13px; color: #3c4043; }

    /* Googleé¢¨ãƒœã‚¿ãƒ³ */
    .btn-google { background-color: #1a73e8; color: white; border: none; border-radius: 4px; padding: 8px 24px; font-weight: 500; }
    .btn-google:hover { background-color: #1765cc; color: white; }

  </style>
</head>
<body>

<div class="dashboard-container">
  
  <div class="sidebar-left">
    <div class="app-title">
      <span class="material-icons">diversity_3</span>
      <span>IKIGAI Workspace</span>
    </div>
    
    <div class="mb-3 px-2">
      <a href="{% url 'menu' %}" class="btn btn-outline-secondary btn-sm w-100" style="border-radius: 18px;">â† ãƒ¡ãƒ‹ãƒ¥ãƒ¼</a>
    </div>

    <div class="section-label">åˆ©ç”¨è€… (Clients)</div>
    <div class="user-item active" onclick="switchUser(this, 'client_001', 'ç”°ä¸­ å¤ªéƒ')">
      <div class="user-avatar" style="background: #ef6c00;">ç”°</div>
      <div>ç”°ä¸­ å¤ªéƒ</div>
    </div>
    <div class="user-item" onclick="switchUser(this, 'client_002', 'éˆ´æœ¨ ãƒãƒŠ')">
      <div class="user-avatar" style="background: #ef6c00;">éˆ´</div>
      <div>éˆ´æœ¨ ãƒãƒŠ</div>
    </div>

    <div class="section-label">è·å“¡ (Staff)</div>
    <div class="user-item" onclick="switchUser(this, 'staff_999', 'ç®¡ç†è€…')">
      <div class="user-avatar" style="background: #1967d2;">ç®¡</div>
      <div>ç®¡ç†è€…</div>
    </div>
  </div>

  <div class="main-content">
    <div class="px-4 pt-3 d-flex align-items-center justify-content-between">
      <h5 class="m-0 text-secondary" id="currentViewLabel">ç”°ä¸­ å¤ªéƒ ã•ã‚“ã®ãƒãƒ¼ãƒˆ</h5>
      
      <button class="btn btn-light btn-sm rounded-circle" onclick="toggleRightSidebar()" title="è©³ç´°ãƒ‘ãƒãƒ«">
        <span class="material-icons" style="font-size: 20px; color: #5f6368;">info</span>
      </button>
    </div>
    <div id="calendar"></div>
  </div>

  <div class="sidebar-right" id="rightSidebar">
    <div class="prop-header">
      <h6 class="m-0" id="propTitle">è©³ç´°æƒ…å ±</h6>
      <button class="close-prop-btn material-icons" onclick="toggleRightSidebar()">close</button>
    </div>
    <div class="p-3" id="propContent" style="overflow-y: auto;">
      <div class="text-center text-muted mt-5">
        <span class="material-icons" style="font-size: 48px; color: #dadce0;">event_note</span>
        <p class="mt-3 small">æ—¥ä»˜ã‚„äºˆå®šã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨<br>ã“ã“ã«è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
      </div>
    </div>
  </div>

</div>

<div class="modal fade" id="actionModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg" style="border-radius: 12px;">
      <div class="modal-header border-0 pb-0">
        <h5 class="modal-title" style="font-size: 18px;">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠ</h5>
        <span class="text-muted ms-2 small" id="modalDateDisplay"></span>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="action-grid">
          <div class="action-card" onclick="startAction('note')">
            <span class="material-icons">edit_note</span>
            <div class="action-label">æ—¥å ±ãƒ»ãƒ¡ãƒ¢</div>
          </div>
          <div class="action-card" onclick="triggerFileUpload()">
            <span class="material-icons">upload_file</span>
            <div class="action-label">ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜</div>
          </div>
          <div class="action-card" onclick="startAction('vital')">
            <span class="material-icons">monitor_heart</span>
            <div class="action-label">ãƒã‚¤ã‚¿ãƒ«è¨˜éŒ²</div>
          </div>
          <div class="action-card" onclick="startAction('schedule')">
            <span class="material-icons">event</span>
            <div class="action-label">äºˆå®šã‚’è¿½åŠ </div>
          </div>
        </div>
        
        <input type="file" id="hiddenFileInput" style="display: none;" onchange="handleFileSelect(this)">
      </div>
    </div>
  </div>
</div>

<script>
  let currentUserId = 'client_001'; // ç¾åœ¨é¸æŠä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  let rightSidebar = document.getElementById('rightSidebar');
  let calendar;

  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    var actionModal = new bootstrap.Modal(document.getElementById('actionModal'));

    calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek' // Dayã¯ã‚¯ãƒªãƒƒã‚¯ã§é·ç§»ã™ã‚‹ã®ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã‹ã‚‰ã¯é™¤å»ã‚‚å¯
      },
      locale: 'ja',
      height: '100%',
      navLinks: true, // æ—¥ä»˜ã‚¯ãƒªãƒƒã‚¯ã§DayViewã¸
      editable: true,
      dayMaxEvents: true,
      
      // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿
      events: [
        { title: 'ãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹', start: new Date(), color: '#1a73e8' },
        { title: 'è¡€åœ§: 130/85', start: new Date(), color: '#ea4335', display: 'list-item' } // ãƒ¡ãƒ¢é¢¨è¡¨ç¤º
      ],

      // æ—¥ä»˜ã‚¯ãƒªãƒƒã‚¯ -> ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤º
      dateClick: function(info) {
        document.getElementById('modalDateDisplay').innerText = info.dateStr;
        actionModal.show();
        // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ‘ãƒãƒ«ã¯é–‰ã˜ã‚‹
        rightSidebar.classList.remove('open');
      },

      // äºˆå®šã‚¯ãƒªãƒƒã‚¯ -> å³ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‹ã„ã¦è©³ç´°è¡¨ç¤º
      eventClick: function(info) {
        info.jsEvent.preventDefault();
        showProperty(info.event);
      }
    });

    calendar.render();
  });

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ‡ã‚Šæ›¿ãˆå‡¦ç†
  function switchUser(element, userId, userName) {
    // 1. UIã®é¸æŠçŠ¶æ…‹ã‚’æ›´æ–°
    document.querySelectorAll('.user-item').forEach(el => el.classList.remove('active'));
    element.classList.add('active');

    // 2. å¤‰æ•°ã‚’æ›´æ–°
    currentUserId = userId;
    document.getElementById('currentViewLabel').innerText = userName + ' ã•ã‚“ã®ãƒãƒ¼ãƒˆ';

    // 3. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ï¼ˆæ“¬ä¼¼çš„ãªå‡¦ç†ï¼‰
    // æœ¬æ¥ã¯ã“ã“ã§ API (fetch) ã‚’å©ã„ã¦ã€userId ã«ç´ã¥ãã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ã—ã¾ã™
    console.log(`Switching to User ID: ${userId}`);
    
    // ãƒ‡ãƒ¢: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå¤‰ã‚ã£ãŸæ„Ÿã‚’å‡ºã™ãŸã‚ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ›¸ãæ›ãˆ
    calendar.removeAllEvents();
    if(userId.includes('client')) {
      calendar.addEvent({ title: 'å…¥æµ´ä»‹åŠ©', start: new Date(), color: '#1a73e8' });
      calendar.addEvent({ title: 'æ—¥å ±: å…ƒæ°—', start: new Date(), color: '#34a853' });
    } else {
      calendar.addEvent({ title: 'å…¨ä½“ä¼šè­°', start: new Date(), color: '#fbbc04', textColor: 'black' });
    }
  }

  // å³ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®é–‹é–‰
  function toggleRightSidebar() {
    rightSidebar.classList.toggle('open');
  }

  // ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¡¨ç¤ºï¼ˆå³ã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼‰
  function showProperty(event) {
    document.getElementById('propTitle').innerText = event.title;
    document.getElementById('propContent').innerHTML = `
      <div class="mb-3">
        <label class="small text-muted">æ—¥æ™‚</label>
        <div>${event.start.toLocaleString()}</div>
      </div>
      <div class="mb-3">
        <label class="small text-muted">æ‹…å½“è€…</label>
        <div>${currentUserId} (è‡ªå‹•è¨˜éŒ²)</div>
      </div>
      <div class="mb-3">
        <label class="small text-muted">ãƒ¡ãƒ¢ãƒ»è©³ç´°</label>
        <textarea class="form-control" rows="5" style="resize:none;">${event.extendedProps.description || 'è©³ç´°ãªã—'}</textarea>
      </div>
      <button class="btn btn-google w-100">ä¿å­˜ã™ã‚‹</button>
    `;
    rightSidebar.classList.add('open');
  }

  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆç”»é¢é·ç§»ãªã—ï¼‰
  function triggerFileUpload() {
    document.getElementById('hiddenFileInput').click();
  }

  function handleFileSelect(input) {
    if (input.files && input.files[0]) {
      const file = input.files[0];
      alert(`ã€ç”»é¢é·ç§»ãªã—ã€‘\nãƒ•ã‚¡ã‚¤ãƒ«ã€Œ${file.name}ã€ã‚’å—ã‘å–ã‚Šã¾ã—ãŸã€‚\n\nè£å´ã§APIçµŒç”±ã§ ${currentUserId} ã•ã‚“ã®ãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã—ã¾ã™ã€‚`);
      
      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
      bootstrap.Modal.getInstance(document.getElementById('actionModal')).hide();
      
      // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«ã€Œãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜ã‚ã‚Šã€ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿½åŠ ï¼ˆå³æ™‚åæ˜ ï¼‰
      calendar.addEvent({
        title: 'ğŸ“ ' + file.name,
        start: new Date(), // æœ¬æ¥ã¯ã‚¯ãƒªãƒƒã‚¯ã—ãŸæ—¥ä»˜
        color: '#5f6368'
      });
    }
  }

  // ãã®ä»–ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  function startAction(type) {
    bootstrap.Modal.getInstance(document.getElementById('actionModal')).hide();
    if(type === 'note') {
        // æœ¬æ¥ã¯æ—¥å ±å…¥åŠ›ç”¨ã®åˆ¥ã®ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å‡ºã™ã‹ã€å³ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚’é–‹ã„ã¦å…¥åŠ›ã•ã›ã‚‹
        alert('æ—¥å ±å…¥åŠ›ãƒ¢ãƒ¼ãƒ‰ï¼š\nå³ã‚µã‚¤ãƒ‰ãƒãƒ¼ãŒé–‹ã„ã¦ã€ãã®ã¾ã¾å…¥åŠ›ãƒ»ä¿å­˜ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚');
        toggleRightSidebar();
    }
  }
</script>

</body>
</html>